# 좋은 코드 리뷰

## 좋은 코드 리뷰를 위한 전제 조건

### 도메인을 공유하고 있는 동료 개발자가 존재하는가?
도메인 지식을 공유하는 동료의 존재여부는 코드리뷰에서 아주 중요하다. 리뷰이가 작성한 PR내 코드들은 작업한 내용만 보여주기 때문에 해당 코드로 인해 발생하는 도메인의 영향범위를 해당 도메인 지식을 공유하고 있는 동료가 존재하지 않는다면 파악하기 쉽지 않다. 리뷰이가 아무리 친절하게 PR의 본문과 commit의 본문에 설명을 적어 놓더라도 말이다. 도메인 지식을 공유하는 리뷰어는 리뷰이가 미처 파악하지 못한 중대한 오류 발견하거나 좀더 효율적이거나 나은 구현방향을 제시해 줄 수 있다.

### 팀내 개발자들이 코드리뷰에 대한 필요성을 인식하고 적극동참할 의지를 가지고 있는가?
좋은 코드리뷰 문화를 가지려면 팀원들이 왜 코드리뷰를 해야하고 어떻게 참가해야 할지를 인지 해야한다. 아마 시간이 지나면서 리뷰에 대한 회의감을 느끼거나 코드리뷰로 인해 불화가 발생하는 팀원이 생길 수도 있다. 그러므로 자주, 종종 코드리뷰를 우리가 왜 하고 있는지 더 잘하기 위한 방법을 생각해야한다.

### 리뷰에 대한 팀내 정책이 확립되었는가?
코드리뷰는 회사마다 팀마다 그 정책이 다를 수 있다. 팀의 상황에 맞게 점점 변화하고 보완해 가기 때문일 텐데, 좋은 리뷰문화를 지속적으로 이어가기 위해서 팀내 코드리뷰에 대한 정책을 확립해둘 필요성이 있다. 정책을 확립할 때 주의해야할 부분은 팀원 대다수의 동의를 얻어서 정하는 것이고, 너무 디테일한 정책은 지양해야 한다는 것이다. 팀의 상황에 따라 처음에 정했던 정책이 변화하기는 하겠지만 자주 변경되는 정책은 오히려 팀원들의 혼란을 초래할 것이다. 팀원 대다수가 동의하지 않거나 너무 디테일한 정책은 변경되기 쉽다. 모호한 부분은 명확하게 하고 디테일한 부분은 상황에 맞게 리뷰어나 리뷰이가 융통성(?)있게 풀어가면 좋겠다.





## 코드리뷰 시 주의할 점

### 코드리뷰 참가자들을 배려하자
코드리뷰의 목적을 상기했다면 다음은 배려이다. 코드리뷰에서 가장 중요한 부분이라고 생각하고 배려가 빠지면 좋은 코드리뷰라는 것이 성립할 수 없다고 생각한다. 결국 코드리뷰는 사람이 하는 활동이다. 서로의 배려없이 리뷰활동이 이어지다보면 감정의 골은 자신도 모르게 깊어질 수 있다. 배려라는 것은 거창한 것이 아니다. 아래에 제시될 항목들도 배려를 전제로 하는 것이긴 하지만 아주 사소하게 내시간을 좀더 투자해서 좋은 리뷰를 남기기 위해 노력하거나 PR을 작성할 때 리뷰이가 좀더 이해하기 쉽게 풀어서 설명한다던지, 리뷰 시 좀더 부드러운 단어를 선택한다던지 등이 될 수 있다.

### 코드의 양과 복잡성을 생각해서 PR을 크기를 줄이자

> PR의 크기가 크면 리뷰가 없고, PR의 크기가 작으면 리뷰가 많다.

PR의 크기는 단순히 코드의 량으로만 판단해선 안된다. 복잡하지 않고 단순 반복되는 코드가 많은 경우라면 PR의 크기는 크지 않을 수도 있다. 결국 PR의 크기란 코드의 량과 함께 복잡성도 함께 고려되어야 한다.

복잡성은 문맥(Context) 또는 목적과도 관련성이 있는데 예를 들어 PR에 새롭게 추가할 기능과 리펙토링 코드가 뒤섞여 있다면 그 PR은 나누어서 작성하는 것이 리뷰어가 리뷰를 하기가 훨씬 좋다. 리펙토링은 리뷰어가 좀더 가볍게 리뷰를 할 수 있을 테고 새로운 기능의 추가에 좀더 집중에서 리뷰에 참가할 수 있기 때문에 좋은 리뷰가 나올 가능성이 높다.


### 테스트
리뷰 내용이 정말 좋아도 반영하기 귀찮을 때가 있다. 그 이유는 내가 구현했던 그 기능이 원래 잘 동작했는데 리뷰를 반영하고 나서도 잘 돌아가는지 다시 확인해봐야하기 때문이다.
하지만 테스트코드를 작성한다면 코드를 변경하여도 기능이 정상적으로 동작하는지 쉽게 테스트할 수 있다.

### Pre-CommitReview
리뷰를 받았는데 리뷰 내용이 설계 전반을 변경해야 하는 리뷰라면 당혹스러울 수 있다.
프리커밋 리뷰는 깃헙에 코드가 커밋되기 전의 리뷰라는 뜻으로, 코들르 작성하기 전에 팀원과 어떻게 구조를 짜고 작업을 진행할지에 대해 논의해보는 것을 의미한다.

#### 장점
1. 과도한 설계 변경 리뷰는 없을것이다.
2. 서로의 관점을 공유함으로서 설계에 대한 인사이트를 얻을 수 있꼬 코드 품질에 대한 기준을 맞출 수 있는 기회가 된다.
3. 해당 제품의 도메인을 알아볼 수 있는 기회가 될 수 있다.
4. 코드리뷰를 하게 됐을 떄 


### 코드 == 나 라는 인식을 버리자
리뷰이는 리뷰어가 지적한 코드가 나에 대한 지적으로 인지하는 경우가 많다.
하지만 이러한 생각을 접어야 한다. 리뷰어는 단순히 지금 작성된 코드에 대해 리뷰를 하는 것인데 
리뷰이가 민감하게 반ㅇ으한다면 리뷰어는 리뷰이의 눈치를 보게 되어 리뷰를 꺼리게 된다.
리뷰를 꺼림으로서 좋은 방향으로 제품이 개발될 수 있는 개선 기회를 놓칠 수 있다.

### 코드 스타일은 되도록 자동화된 formatting tool, lint로 해결하자
컨벤션은 툴에 맡기고 리뷰어는 다른 중요한 포인트를 집는데 집중하자

### 예제코드를 제공해라
리뷰에서 단순히 작성된 코드를 수정해달라는 코멘트를 남기는 것 보다는 예제코드를 통해 제안하느 방법은 리뷰이에게 아주 친절한 리뷰이다. 
예시 코드만큼 리뷰어의 의도를 명확하게 표현하는 방법은 없다.
하지만 너무 과하면 친절한 것을 넘어 억압일 수 있다.
중요한 부분만 작성하고 세세한 부분은 리뷰이가 알아서 할 수 있도록 최고한으로 유지하는게 좋다.


### 고수준에서 저수준으로 리뷰하라
고심해서 작성한 코드를 PR을 작성한 후 리뷰 요청을 하였는데, 수십개의 리뷰가 달린다고 생각해보자. 아마도 리뷰이는 당황스러울 것이다. 이런 상황은 팀에 합류한지 얼마 되지 않은 팀원인 경우 더 높은 확율로 마주칠 가능성이 높다. 팀내 코딩 정책도 익숙하지 않을 수도 있고, 긴장감 또는 기존의 습관 등등 아직 팀의 문화에 적응하기 전이니 리뷰어들은 더더욱 꼼꼼하게 코드리뷰를 수행할 것이고 수정할 만한 것들이 아주많이 보일 것이다.

고수준 부터 1차 리뷰를 한 후 2차로 저수준 코드를 리뷰하는 방법을 채택하면 리뷰이가 처음부터 어마어마한 코드 리뷰 수를 마주치게되면서 당황하는 상황을 다소 피할 수 있다. 고수준은 인터페이스 설계나 구조 등등을 본다고 생각하면 될것이고 저수준은 오탈자나 주석, 세부적인 코드 스타일등을 말하는 것이다.

### 객관적으로 피드백해라
`별론거 같아요`. `이때까지 이렇게 해왔어요` 와 같은 리뷰와 피드백은 좋지 않다.
명확하고 객관적인 이유가 없는 리뷰는 차라리 달지 않는것이 리뷰어와 리뷰이의 에너지를 소비를 줄일 수 있다.

### 반복적인 패턴에 대해서 피드백을 제한하라Permalink
동일 패턴에 대한 리뷰는 2~3번정도만 언급하거나 하나의 리뷰로 나머지도 확인해달라는 요청을 해보자. 이는 고수준에서 저수준으로 리뷰하라에서 언급했던 코드리뷰의 수를 줄임으로써 리뷰이가 당황하는 것을 방지하는 방법중 하나이다.

## 사례
[링크](https://www.samsungsds.com/kr/insights/global_code_review.html)!


### 100% 코드 리뷰, 모든 코드를 리뷰하는 Google

![](/Users/bagbyeongho/Documents/두잉랩/기술세미나 22년 11월/Google_codeReview)

Google은 [코드 리뷰 개발자 가이드](https://google.github.io/eng-practices/review/)를 통해 코딩 스타일을 비롯한 주요 원칙을 공개하고
 있습니다.
- 코드가 잘 설계되고 시스템에 적합한가? (설계)
- 코드는 설계자의 의도대로 동작하는가? (기능)
- 자동화된 테스트가 적용되어 있는가? (테스트)

코드 리뷰의 진행 속도는 개발 생산성에 중대한 영향을 미치며, 코드 리뷰도 이에 따라 신속히 이뤄줘야 한다는 점도 강조하고 있다.
Google은 코드 리뷰가 요청되고 나서 1영업일 이내에 반드시 코드 리뷰가 완료되어야 하는 것을 원칙으로 합니다. 심지어 다음 날 아침 최우선 업무로 코드 리뷰를 처리해야 한다고 규정합니다.
왜냐하면 코드리뷰가 늦어지면 개발팀의 개발 일정이 문제가 되기 때문입니다.
Google의 코드리뷰는 작은 변경은 1시간 이내, 규모가 큰 변경사항은 5시간 이내에 완료됩니다. 
평균적으로 4시간 이내에 완료된다고 합니다.(다른 대기업에 경우 15시간 이상이 소요된다.)
Google의 코드리뷰의 90%는 10개 미만의 파일도 구성되어 있고, 리뷰의 75%는 리뷰어가 한명뿐이다.
변경 요구사항(Change List; CL)의 규모가 크고, 코드 리뷰 대상이 크면 클수록 코드 리뷰 시간은 길어지기 마련입니다. 그래서, Google에서는 변경사항의 전체를 조망해 보고, 주요 부분을 작게 나누어 리뷰할 수 있도록 CL을 여러 개의 CL로 분할한 다음 적절한 순서로 살펴보도록 권장하고 있죠.